<% if (item.cover_image){ %>
  <div class="col-12 mb-4">
    <img class="img-fluid project-img" src="<%- config.root %><%- item.cover_image %>" alt="<%- item.title || "Untitled" %>">
  </div>
<% } %>
<div class="row pt-lg-3 mb-4 px-4 portfolio-content justify-content-sm-end">
  <%- item.content %>
</div>
<div class="expWindow d-flex">
  <div class="close-tag"></div>
  <div id="expArticle" class="">
      <h5></h5>
      <p></p>
      <p></p>
      <a href="" role="button">查看詳細介紹Go</a>
  </div>
  <div id="expGallery" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
      <li data-target="#expGallery" data-slide-to="0" class="active"></li>
      <li data-target="#expGallery" data-slide-to="1"></li>
    </ol>
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img id="expGalleryImg-1" class="d-block" src="" alt="First slide">
      </div>
      <div class="carousel-item">
        <img id="expGalleryImg-2" class="d-block" src="" alt="Second slide">
      </div>
    </div>
    <a class="carousel-control-prev" href="#expGallery" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#expGallery" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
</div>

<script>
//定義calssName
var sideBar = $('.sideBar') ;
//sideBar距離上面
var sticky = $('.sideBar').offset().top;
// var stickyXS = sticky-50;
var stickySM = sticky-22;
//裝置寬度
var deviceWidth = $(window).width();
//break point
var smSize = 575.98;


$(document).ready(function(){
  console.log('document ready(o)');
  fixSideBar();
});

//調整裝置大小時
$(window).resize(function() {
  deviceWidth = $(window).width();
  console.log('resize........to ' + deviceWidth + 'px');
  showActive(); //重新判斷active的條件
});

//捲動視窗時  
$(window).scroll(function(){
  console.log('----------------\nwindow is scrolling to ' + window.pageYOffset + 
  'px,\n and sideBar is away from top ' + sideBar.offset().top + ' px\n---------------');  
  fixSideBar(); //固定sideBar
  showActive(); //顯示active樣式
});


function showActive() {
  if( deviceWidth > smSize ){ //裝置高於575.98px時，顯示active的區域

    $('.sideBarContent a').css('border-bottom','none');//把border-bottom的樣式取消
    
    if(sideBar.offset().top+22 < 540){
      $('.js-scroll-trigger').css('border-right','rgba(0, 0, 0, 0.01) 5px solid');
      $('.js-scroll-trigger').css('color','#595959');
      $('#aboutTarget').css('border-right','rgba(0, 0, 0, 0.2) 5px solid');
      $('#aboutTarget').css('color','#050505');
    }else if(sideBar.offset().top+22 >= 540 && sideBar.offset().top+22 < 1090){
      $('.js-scroll-trigger').css('border-right','rgba(0, 0, 0, 0.01) 5px solid');
      $('.js-scroll-trigger').css('color','#595959');      
      $('#experienceTarget').css('border-right','rgba(0, 0, 0, 0.2) 5px solid');
      $('#experienceTarget').css('color','#050505');
    }else if(sideBar.offset().top+22 >= 1090){
      $('.js-scroll-trigger').css('border-right','rgba(0, 0, 0, 0.01) 5px solid');
      $('.js-scroll-trigger').css('color','#595959');      
      $('#skillTarget').css('border-right','rgba(0, 0, 0, 0.2) 5px solid');
      $('#skillTarget').css('color','#050505');
    }

  }else{ //裝置低於575.98px時，顯示active的區域

    $('.sideBarContent a').css('border-right','none');//把border-right的樣式取消

    if(window.pageYOffset < 540){
      $('.js-scroll-trigger').css('border-bottom','rgba(0, 0, 0, 0.01) 5px solid');
      $('.js-scroll-trigger').css('color','#595959');
      $('#aboutTarget').css('border-bottom','rgba(0, 0, 0, 0.2) 5px solid');
      $('#aboutTarget').css('color','#050505');
    }else if(window.pageYOffset < 1220){
      $('.js-scroll-trigger').css('border-bottom','rgba(0, 0, 0, 0.01) 5px solid');
      $('.js-scroll-trigger').css('color','#595959');      
      $('#experienceTarget').css('border-bottom','rgba(0, 0, 0, 0.2) 5px solid');
      $('#experienceTarget').css('color','#050505');
    }else if(window.pageYOffset >= 1220){
      $('.js-scroll-trigger').css('border-bottom','rgba(0, 0, 0, 0.01) 5px solid');
      $('.js-scroll-trigger').css('color','#595959');      
      $('#skillTarget').css('border-bottom','rgba(0, 0, 0, 0.2) 5px solid');
      $('#skillTarget').css('color','#050505');
    }

  }
}

function fixSideBar() {
  if( deviceWidth > smSize ){
    if (window.pageYOffset >= stickySM) {
      $('.sideBar').addClass('sticky');
    } else {
      $('.sideBar').removeClass('sticky'); 
    }
  }else{
    if (window.pageYOffset >= 70) {
      $('.sideBar').addClass('sticky');
    } else {
      $('.sideBar').removeClass('sticky'); 
    }
  }
}


//點擊sideBarContent的動畫
$('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function() {    
  if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
    var target = $(this.hash);
    target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
    console.log('' + this.hash + '=' + target.offset().top);
    if (target.length) {
      if( deviceWidth > smSize ){
        $('html, body').animate({
          scrollTop: target.offset().top-20
        }, 1000, "easeInOutExpo");
        return false;
      }else{
        $('html, body').animate({
          scrollTop: target.offset().top-140
        }, 1000, "easeInOutExpo");
        return false;
      }
    }
  }
});

// $('.timeline-content:not(.now)').click(function() {
$('.btn_more').click(function() {
  var clicked_content = $(this).parent('div').parent('.timeline-content');

  var src1 = clicked_content.data('src1');
  var src2 = clicked_content.data('src2');
  var title = clicked_content.data('title');
  var subtitle = clicked_content.data('subtitle');
  var des = clicked_content.data('des');
  var haslink = clicked_content.data('haslink');
  var link = clicked_content.data('link');
  
  if(src1 !== 'none' && src2 !== 'none'){
    $('#expGallery').css('display','flex');
    $('#expArticle').css('width','50%');
    $('#expGalleryImg-1').attr('src',src1);
    $('#expGalleryImg-2').attr('src',src2);
  }else if(src1 !== 'none' && src2 == 'none'){
    $('#expGallery').css('display','flex');
    $('#expArticle').css('width','50%');
    $('#expGalleryImg-1').attr('src',src1);
    $('#expGalleryImg-2').attr('src',src1);
  }else if(src1 == 'none' && src2 == 'none'){
    $('#expGallery').css('display','none');
    $('#expArticle').css('width','100%');
  }
 
  $('#expArticle h5').html(title);
  $('#expArticle p:first').html(subtitle);
  $('#expArticle p:last').html(des);
  $('.expWindow').addClass('window-show');
  if( haslink == 'yes' ){
    $('#expArticle a').attr('href',link);
  }else if( haslink == 'none' ){
    $('#expArticle a').css('display','none');
  }
})

$('.close-tag').click(function(){
  console.log('close-tag clicked');
  $('.expWindow').removeClass('window-show');
});

    

$(document).keyup(function(e){
  var keyWhich =  e.which;
  var keyCode =  e.keyCode;
  if(keyWhich == 27 || keyCode == 27){
      $('.expWindow').removeClass('window-show');
  }
});

//複製我的資料
function copyInfo(id) {
  console.log('test==');

  var $temp = $("<input>");
  $("body").append($temp);
  $temp.val($(id).children('span').text()).select();
  document.execCommand("copy");
  $temp.remove();

  if(id == '#phone'){
    popUpDialog('成功複製<b>電話號碼</b>！');
  }else if(id == '#email'){
    popUpDialog('成功複製<b>電子郵件</b>！');
  }else{
    return;
  }

}
function popUpDialog(content){
  $('.popup').html(content);
  $('.popup').fadeIn(1000,function(){
      $('.popup').fadeOut(1500);
  });
}

</script>
